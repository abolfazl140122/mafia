<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§ - Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --wood-dark: #1a140f;
            --wood-texture-url: url('https://www.transparenttextures.com/patterns/dark-wood.png');
            --panel-bg-gradient: linear-gradient(145deg, #4a3a2a, #2c2218);
            --panel-border: #5c4a3a;
            --text-gold: #ffc947;
            --text-light: #e0dacc;
            --glow-green: #39ff14;
            --glow-red: #ff3131;
            --logo-glow-main: #ffdd00;
            --progress-bar-bg: #2a1f15;
            --progress-bar-fill-start: #1eff00;
            --progress-bar-fill-end: #00ff87;
            --progress-bar-error-start: #ff416c;
            --progress-bar-error-end: #ff4b2b;
            --maintenance-icon-color: #ffc947;
            --countdown-bg: rgba(0,0,0,0.2);
        }
        @keyframes panel-intro { from { opacity: 0; transform: translateY(50px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes dual-glow-pulse { 0% { transform: rotate(0deg) scale(1); opacity: 0.7; } 50% { transform: rotate(180deg) scale(1.1); opacity: 1; } 100% { transform: rotate(360deg) scale(1); opacity: 0.7; } }
        @keyframes logo-glow { 0%, 100% { filter: drop-shadow(0 0 8px var(--logo-glow-main)) drop-shadow(0 0 16px rgba(255, 221, 0, 0.5)); } 50% { filter: drop-shadow(0 0 16px var(--logo-glow-main)) drop-shadow(0 0 32px rgba(255, 221, 0, 0.7)); } }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Vazirmatn', sans-serif; background-color: var(--wood-dark); background-image: var(--wood-texture-url); color: var(--text-light); display: flex; align-items: center; justify-content: center; }
        
        /* Styles for Both Panels */
        .panel {
            width: 100%;
            max-width: 480px;
            background: var(--panel-bg-gradient);
            border-radius: 24px;
            border: 2px solid var(--panel-border);
            padding: 30px 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: panel-intro 1s cubic-bezier(0.25, 1, 0.5, 1);
        }
        
        /* Loading Panel Specifics */
        #logo-container { position: relative; margin: 0 auto 25px auto; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; }
        #logo-container::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: conic-gradient(var(--glow-green), var(--glow-red), var(--glow-green)); filter: blur(40px); animation: dual-glow-pulse 6s linear infinite; }
        #logo { width: 100%; height: auto; position: relative; z-index: 1; animation: logo-glow 3s ease-in-out infinite; }
        #title { font-size: 3rem; font-weight: 900; color: var(--text-gold); margin-bottom: 30px; text-shadow: 0 0 5px rgba(255, 201, 71, 0.5), 2px 2px 4px rgba(0,0,0,0.5); }
        #progress-bar-container { width: 100%; height: 20px; background-color: var(--progress-bar-bg); border-radius: 10px; padding: 3px; margin-bottom: 15px; }
        #progress-bar-fill { width: 0%; height: 100%; border-radius: 7px; background: linear-gradient(90deg, var(--progress-bar-fill-start), var(--progress-bar-fill-end)); transition: width 0.5s cubic-bezier(0.65, 0, 0.35, 1), background 0.5s ease; }
        #progress-bar-fill.error { background: linear-gradient(90deg, var(--progress-bar-error-start), var(--progress-bar-error-end)); }
        #status-message { font-size: 1.1rem; font-weight: 700; min-height: 28px; color: var(--text-light); }

        /* Maintenance Panel Styles */
        #maintenance-icon {
            width: 80px;
            height: 80px;
            color: var(--maintenance-icon-color);
            margin: 0 auto 20px auto;
            filter: drop-shadow(0 0 10px rgba(255, 201, 71, 0.6));
        }
        #maintenance-title {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--text-gold);
            margin-bottom: 15px;
        }
        #maintenance-message {
            font-size: 1rem;
            line-height: 1.8;
            margin-bottom: 30px;
            color: var(--text-light);
        }
        #countdown-timer {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .time-block {
            background-color: var(--countdown-bg);
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--panel-border);
            min-width: 70px;
        }
        .time-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
        }
        .time-label {
            font-size: 0.8rem;
            font-weight: 400;
            color: var(--text-light);
        }
    </style>
</head>
<body>

    <!-- Ù¾Ù†Ù„ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø§ØµÙ„ÛŒ - Ø¯Ø± Ø­Ø§Ù„Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø®ÙÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
    <div id="loading-panel" class="panel">
        <div id="logo-container">
            <img id="logo" src="https://up.20script.ir/file/40b6-Copilot-20250812-110015-removebg-preview.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§">
        </div>
        <h1 id="title">Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§</h1>
        <div id="progress-bar-container">
            <div id="progress-bar-fill"></div>
        </div>
        <p id="status-message">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡ Ø³Ø§Ø²ÛŒ...</p>
    </div>

    <!-- Ù¾Ù†Ù„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ - Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø®ÙÛŒ Ø§Ø³Øª -->
    <div id="maintenance-panel" class="panel" style="display: none;">
        <svg id="maintenance-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"></path>
        </svg>
        <h1 id="maintenance-title"></h1>
        <p id="maintenance-message"></p>
        <div id="countdown-timer">
            <div class="time-block">
                <div id="days" class="time-value">00</div>
                <div class="time-label">Ø±ÙˆØ²</div>
            </div>
            <div class="time-block">
                <div id="hours" class="time-value">00</div>
                <div class="time-label">Ø³Ø§Ø¹Øª</div>
            </div>
            <div class="time-block">
                <div id="minutes" class="time-value">00</div>
                <div class="time-label">Ø¯Ù‚ÛŒÙ‚Ù‡</div>
            </div>
            <div class="time-block">
                <div id="seconds" class="time-value">00</div>
                <div class="time-label">Ø«Ø§Ù†ÛŒÙ‡</div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // ===================================================================
        // ================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø­Ø§Ù„Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ (Maintenance) =================
        // ===================================================================
        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø²Ù…Ø§Ù† Ø¢ÛŒÙ†Ø¯Ù‡
        const getFutureTime = (hours) => {
            const future = new Date();
            future.setHours(future.getHours() + hours);
            const year = future.getFullYear();
            const month = String(future.getMonth() + 1).padStart(2, '0');
            const day = String(future.getDate()).padStart(2, '0');
            const h = String(future.getHours()).padStart(2, '0');
            const m = String(future.getMinutes()).padStart(2, '0');
            const s = String(future.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day}T${h}:${m}:${s}`;
        };

        const maintenanceConfig = {
            // Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø­Ø§Ù„Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒØŒ Ø§ÛŒÙ† Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ Ø¨Ù‡ true ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯
            enabled: true, 

            // Ù…ÙˆØ¶ÙˆØ¹ ÛŒØ§ Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ Ù¾Ù†Ù„
            title: "ğŸš§ Ø³Ø±ÙˆØ± Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ğŸš§",

            // Ù…ØªÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
            message: "Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø±Ø®ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ Ø¨Ø± Ø±ÙˆÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ù‡Ø³ØªÛŒÙ…. Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø¯ÙˆØ¯ Û² Ø³Ø§Ø¹Øª Ø²Ù…Ø§Ù† Ø®ÙˆØ§Ù‡Ø¯ Ø¨Ø±Ø¯. Ø§Ø² Ø´Ú©ÛŒØ¨Ø§ÛŒÛŒ Ø´Ù…Ø§ Ø³Ù¾Ø§Ø³Ú¯Ø²Ø§Ø±ÛŒÙ…!",

            // Ø²Ù…Ø§Ù† Ù¾Ø§ÛŒØ§Ù† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ (Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Û² Ø³Ø§Ø¹Øª Ø¢ÛŒÙ†Ø¯Ù‡ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª)
            endTime: getFutureTime(2)
        };
        // ===================================================================

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
        function main() {
            // Ø§Ø¨ØªØ¯Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ø¢ÛŒØ§ Ø­Ø§Ù„Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙØ¹Ø§Ù„ Ø§Ø³Øª ÛŒØ§ Ø®ÛŒØ±
            if (maintenanceConfig.enabled) {
                showMaintenancePanel();
                return; // Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ú©Ø¯ Ù…ØªÙˆÙ‚Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯
            }

            // Ø§Ú¯Ø± Ø­Ø§Ù„Øª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙØ¹Ø§Ù„ Ù†Ø¨ÙˆØ¯ØŒ ÙØ±Ø¢ÛŒÙ†Ø¯ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø¹Ø§Ø¯ÛŒ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            startNormalLoading();
        }

        function showMaintenancePanel() {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù¾Ù†Ù„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
            document.getElementById('loading-panel').style.display = 'none';
            const maintenancePanel = document.getElementById('maintenance-panel');
            maintenancePanel.style.display = 'block';

            // ØªÙ†Ø¸ÛŒÙ… Ù…Ø­ØªÙˆØ§ÛŒ Ù¾Ù†Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            document.getElementById('maintenance-title').textContent = maintenanceConfig.title;
            document.getElementById('maintenance-message').textContent = maintenanceConfig.message;

            // Ø´Ø±ÙˆØ¹ Ø´Ù…Ø§Ø±Ø´Ú¯Ø± Ù…Ø¹Ú©ÙˆØ³
            startCountdown(maintenanceConfig.endTime);
        }

        function startCountdown(endTimeString) {
            const countdownElements = {
                days: document.getElementById('days'),
                hours: document.getElementById('hours'),
                minutes: document.getElementById('minutes'),
                seconds: document.getElementById('seconds')
            };

            const targetDate = new Date(endTimeString).getTime();

            const interval = setInterval(() => {
                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance < 0) {
                    clearInterval(interval);
                    document.getElementById('countdown-timer').innerHTML = "<p style='font-size: 1.2rem; color: var(--glow-green);'>Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.</p>";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                countdownElements.days.textContent = String(days).padStart(2, '0');
                countdownElements.hours.textContent = String(hours).padStart(2, '0');
                countdownElements.minutes.textContent = String(minutes).padStart(2, '0');
                countdownElements.seconds.textContent = String(seconds).padStart(2, '0');

            }, 1000);
        }


        async function startNormalLoading() {
            const firebaseConfig = {
                apiKey: "AIzaSyADQNadPyy43TmSR2yCiKjoLBVMeAqT4Zg",
                authDomain: "mafia-9fcbf.firebaseapp.com",
                projectId: "mafia-9fcbf",
                storageBucket: "mafia-9fcbf.appspot.com",
                messagingSenderId: "471627157488",
                appId: "1:471627157488:web:92f008548a5596619a5735",
                measurementId: "G-0PDHDWC6NV"
            };
            
            const progressBarFill = document.getElementById('progress-bar-fill');
            const statusMessage = document.getElementById('status-message');
            const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            function updateProgress(percent, message) {
                progressBarFill.style.width = `${percent}%`;
                statusMessage.textContent = message;
            }

            try {
                updateProgress(20, '...Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ…');
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);
                updateProgress(40, '...Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ø´Ù‡Ø±');

                onAuthStateChanged(auth, async (user) => {
                    await delay(500); 

                    if (user) {
                        updateProgress(70, '...Ø¯Ø± Ø­Ø§Ù„ ÙˆØ§Ú©Ø´ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒÚ©Ù†');
                        const userDocRef = doc(db, 'users', user.uid);
                        const userDocSnap = await getDoc(userDocRef);
                        let displayName = user.displayName || 'Ø¨Ø§Ø²ÛŒÚ©Ù†';
                        
                        if (userDocSnap.exists()) {
                            displayName = userDocSnap.data().displayName || displayName;
                        }

                        updateProgress(100, `Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ ${displayName}!`);
                        await delay(1500); 
                        
                        window.location.href = './main.html';

                    } else {
                        updateProgress(100, 'Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯.');
                        await delay(1000);
                        updateProgress(100, 'Ø¯Ø± Ø­Ø§Ù„ Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯...');
                        await delay(1500);
                        
                        window.location.href = './login.html';
                    }
                });

            } catch (error) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ù„ÙˆØ¯ÛŒÙ†Ú¯:", error);
                progressBarFill.classList.add('error');
                updateProgress(100, 'Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„!');
                statusMessage.textContent = 'Ø§Ù…Ú©Ø§Ù† Ø§ØªØµØ§Ù„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.';
            }
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
        main();

    </script>
</body>
</html>
