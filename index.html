<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia - Loading...</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lalezar&family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- استایل‌های کلی --- */
        :root {
            --primary-brown: #3E2723; /* قهوه‌ای سوخته تیره */
            --secondary-brown: #5D4037; /* قهوه‌ای چوب */
            --accent-gold: #FFC107; /* طلایی برای تاکید */
            --text-color: #D7CCC8; /* کرم روشن برای متن */
            --background-color: #1f1a18; /* پس‌زمینه بسیار تیره با ته‌مایه قهوه‌ای */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--background-color);
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.03), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.02), transparent 30%);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            transition: opacity 0.5s ease-in-out;
        }

        /* --- کانتینر اصلی لودینگ --- */
        .loading-container {
            text-align: center;
            width: 90%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px; /* فاصله بین عناصر */
        }

        /* --- انیمیشن محو شدن برای خروج --- */
        body.fade-out {
            opacity: 0;
        }

        /* --- عنوان بازی --- */
        .game-title {
            font-family: 'Lalezar', cursive;
            font-size: 4rem;
            color: var(--accent-gold);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            letter-spacing: 2px;
            animation: flicker 3s infinite alternate;
        }

        @keyframes flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow:
                0 0 4px #fff,
                0 0 11px var(--accent-gold),
                0 0 19px var(--accent-gold),
                0 0 40px var(--accent-gold),
                2px 2px 8px rgba(0, 0, 0, 0.7);
            }
            20%, 24%, 55% {        
                text-shadow: none;
            }
        }
        
        /* --- آیکون متحرک --- */
        .mafia-icon {
            width: 80px;
            height: 80px;
            animation: spin-and-pulse 4s ease-in-out infinite;
        }
        
        @keyframes spin-and-pulse {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* --- نوار پیشرفت --- */
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--primary-brown);
            border: 1px solid var(--secondary-brown);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }

        .progress-bar-fill {
            height: 100%;
            width: 0;
            background-color: var(--accent-gold);
            border-radius: 5px;
            transition: width 1.5s cubic-bezier(0.65, 0, 0.35, 1); /* انیمیشن نرم برای پر شدن */
            box-shadow: 0 0 10px var(--accent-gold);
        }
        
        /* --- متن وضعیت --- */
        .status-text {
            font-size: 1rem;
            min-height: 24px; /* جلوگیری از پرش صفحه هنگام تغییر متن */
            letter-spacing: 0.5px;
            transition: color 0.5s;
        }
        
        .status-text.error {
            color: #E57373; /* رنگ قرمز برای خطا */
        }
        .status-text.success {
            color: #81C784; /* رنگ سبز برای موفقیت */
        }

    </style>
</head>
<body>

    <div class="loading-container">
        <h1 class="game-title">مافیا</h1>
        
        <!-- آیکون: یک کلاه فدورا -->
        <svg class="mafia-icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M85 50H15C15 30.67 30.67 15 50 15C69.33 15 85 30.67 85 50Z" fill="var(--secondary-brown)"/>
            <path d="M95 60H5C2.23858 60 0 57.7614 0 55V50H100V55C100 57.7614 97.7614 60 95 60Z" fill="var(--primary-brown)"/>
            <rect x="10" y="60" width="80" height="5" fill="var(--accent-gold)"/>
        </svg>

        <div class="progress-bar">
            <div id="progress-bar-fill" class="progress-bar-fill"></div>
        </div>
        <p id="status-text" class="status-text">در حال آماده‌سازی...</p>
    </div>

    <!-- Firebase SDK Scripts -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyADQNadPyy43TmSR2yCiKjoLBVMeAqT4Zg",
        authDomain: "mafia-9fcbf.firebaseapp.com",
        projectId: "mafia-9fcbf",
        storageBucket: "mafia-9fcbf.firebasestorage.app",
        messagingSenderId: "471627157488",
        appId: "1:471627157488:web:92f008548a5596619a5735",
        measurementId: "G-0PDHDWC6NV"
      };
      
      // ====================================================================
      //                     منطق اسکریپت لودینگ
      // ====================================================================

      // گرفتن ارجاع به عناصر DOM
      const progressBar = document.getElementById('progress-bar-fill');
      const statusText = document.getElementById('status-text');
      const body = document.body;

      // تابع برای بروزرسانی وضعیت
      function updateStatus(text, progress, isError = false, isSuccess = false) {
          statusText.textContent = text;
          progressBar.style.width = `${progress}%`;
          statusText.classList.remove('error', 'success');
          if (isError) {
              statusText.classList.add('error');
          }
          if (isSuccess) {
              statusText.classList.add('success');
          }
      }

      // شروع فرآیند لودینگ وقتی صفحه کاملا بارگذاری شد
      window.addEventListener('load', () => {
          startLoadingProcess();
      });

      function startLoadingProcess() {
          // مرحله ۱: شروع و بررسی اولیه
          setTimeout(() => {
              updateStatus('بررسی اتصال به اینترنت...', 25);
              
              // مرحله ۲: بررسی اتصال اینترنت
              if (!navigator.onLine) {
                  updateStatus('خطا: به اینترنت متصل نیستید!', 40, true);
                  // متوقف کردن فرآیند
                  return; 
              }

              // اگر اینترنت وصل بود، ادامه بده
              setTimeout(() => {
                  updateStatus('اتصال به سرورهای بازی...', 60);

                  // مرحله ۳: تلاش برای اتصال به فایربیس
                  try {
                      // Initialize Firebase
                      const app = initializeApp(firebaseConfig);
                      console.log("Firebase Initialized Successfully!");

                      // اگر موفق بود
                      setTimeout(() => {
                          updateStatus('اتصال موفقیت آمیز بود!', 100, false, true);
                          
                          // مرحله ۴: انتقال به صفحه بازی
                          setTimeout(() => {
                              body.classList.add('fade-out');
                              
                              // منتظر بمان تا انیمیشن fade-out تمام شود
                              setTimeout(() => {
                                  // آدرس صفحه اصلی بازی خود را اینجا قرار دهید
                                  window.location.href = 'game.html'; 
                              }, 500); // این زمان باید با زمان transition در CSS یکسان باشد

                          }, 1500); // 1.5 ثانیه نمایش پیام موفقیت

                      }, 1500); // 1.5 ثانیه برای شبیه‌سازی اتصال به سرور

                  } catch (error) {
                      console.error("Firebase Initialization Failed:", error);
                      updateStatus('خطا: سرور در دسترس نیست!', 70, true);
                      // متوقف کردن فرآیند
                      return;
                  }

              }, 1000); // ۱ ثانیه تاخیر برای نمایش پیام بررسی اینترنت

          }, 500); // نیم ثانیه تاخیر اولیه
      }
    </script>
</body>
</html>