<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شهر مافیا - در حال بارگذاری...</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="auth-container" id="loading-screen">
        <img class="logo pulsing" src="https://up.20script.ir/file/28e7-Copilot-20250812-110015-removebg-preview.png" alt="لوگوی بازی مافیا">
        <h1>شهر مافیا</h1>
        
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        
        <p id="status-message">
            <span id="status-text">در حال آماده‌سازی...</span>
            <span id="status-icon"></span>
        </p>

        <!-- Options shown after successful connection -->
        <div id="auth-options">
            <a href="login.html" class="btn">ورود به حساب</a>
            <a href="registration.html" class="btn">ایجاد حساب جدید</a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyADQNadPyy43TmSR2yCiKjoLBVMeAqT4Zg",
            authDomain: "mafia-9fcbf.firebaseapp.com",
            projectId: "mafia-9fcbf",
            storageBucket: "mafia-9fcbf.firebasestorage.app",
            messagingSenderId: "471627157488",
            appId: "1:471627157488:web:92f008548a5596619a5735",
            measurementId: "G-0PDHDWC6NV"
        };
        
        const progressBar = document.getElementById('progress-bar');
        const statusText = document.getElementById('status-text');
        const statusIcon = document.getElementById('status-icon');
        const statusMessage = document.getElementById('status-message');
        const progressContainer = document.getElementById('progress-container');
        const authOptions = document.getElementById('auth-options');

        async function initializeAppFlow() {
            if (!navigator.onLine) {
                showError("عدم اتصال به اینترنت!");
                return;
            }
            updateProgress(25, "در حال آماده‌سازی...", '<span class="spinner"></span>');
            setTimeout(connectToFirebase, 1000);
        }
        
        async function connectToFirebase() {
            updateProgress(70, "در حال برقراری ارتباط با سرور...", '<span class="spinner"></span>');
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                await signInAnonymously(auth);
                handleSuccess();
            } catch (error) {
                console.error("Firebase Connection Error:", error);
                showError("خطا در اتصال به سرور!");
            }
        }

        function handleSuccess() {
            updateProgress(100, "اتصال موفق!", '✔️');
            statusMessage.classList.add('success');
            
            setTimeout(() => {
                progressContainer.style.display = 'none';
                statusMessage.style.display = 'none';
                authOptions.style.display = 'flex'; // Show login/register buttons
            }, 1200);
        }

        function showError(message) {
            updateProgress(progressBar.style.width.replace('%',''), message, '❌');
            statusMessage.classList.add('error');
            // In a real app, a retry button could be shown here.
        }

        function updateProgress(percentage, text, iconHtml = '') {
            if (progressBar) progressBar.style.width = `${percentage}%`;
            if (statusText) statusText.textContent = text;
            if (statusIcon) statusIcon.innerHTML = iconHtml;
        }
        
        document.addEventListener('DOMContentLoaded', initializeAppFlow);
    </script>
</body>
</html>